@startuml
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceArrowThickness 2
skinparam roundcorner 10

actor "Application" as App
participant "JwtExecutor" as JWT
participant "JwtProperties" as Props
database "Signing Key" as Key

== Token Generation ==
App -> JWT: generateToken(request)
activate JWT
JWT -> Props: Get default configuration
Props --> JWT: issuer, audience, signingKeyId, expiration
JWT -> Key: Generate signing key from keyId
activate Key
Key --> JWT: HMAC-SHA256 key
deactivate Key
JWT -> JWT: Build JWT with claims
JWT -> JWT: Sign with HMAC-SHA256
JWT --> App: JwtTokenResponse (token, expiresAt, claims)
deactivate JWT

== Token Validation ==
App -> JWT: validateToken(request)
activate JWT
JWT -> Props: Get default configuration
Props --> JWT: issuer, audience, signingKeyId
JWT -> Key: Generate signing key from keyId
activate Key
Key --> JWT: HMAC-SHA256 key
deactivate Key
JWT -> JWT: Verify signature
JWT -> JWT: Validate issuer & audience
JWT -> JWT: Check expiration
JWT --> App: JwtValidationResponse (valid, claims, subject)
deactivate JWT

note right of JWT
  Token includes:
  - Header (algorithm)
  - Payload (claims, issuer, audience, exp, iat)
  - Signature (HMAC-SHA256)
end note

@enduml

